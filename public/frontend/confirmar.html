<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Confirmar Presen√ßa</title>
<link rel="stylesheet" href="confirmar.css">
</head>
<body>

<div class="container">

    <!-- FORMUL√ÅRIO -->
    <div id="formulario">
        <h1>Confirme sua presen√ßa</h1>
        <p class="texto">
            Queridos amigos e familiares! <br><br>
            Confirme sua presen√ßa para que possamos preparar tudo com carinho.
        </p>

        <form id="formPresenca">
            <div id="lista-pessoas">
                <div class="pessoa">
                    <input type="text" placeholder="Nome" required>
                    <input type="text" placeholder="Sobrenome" required>
                    <button type="button" class="remover" onclick="this.parentElement.remove()">‚úï</button>
                </div>
            </div>

            <button type="button" class="btn-secundario" onclick="adicionarPessoa()">
                + Adicionar pessoa
            </button>

            <div class="botoes">
                <a href="index.html" class="btn-voltar">‚Üê Voltar</a>
                <button type="submit" class="btn">Confirmar Presen√ßa</button>
            </div>
        </form>
    </div>

    <!-- LOCALIZA√á√ÉO -->
    <div id="localizacao" class="hidden">
        <h1>Presen√ßa confirmada! üíõ</h1>
        <p class="texto">
            Ficamos muito felizes com a sua confirma√ß√£o!<br>
            Abaixo est√° a localiza√ß√£o do nosso ch√° de casa nova:
        </p>
        <p class="endereco">
            üìç Rua Exemplo, 123 ‚Äì Bairro Centro<br>
            S√£o Paulo ‚Äì SP
        </p>
        <a href="https://www.google.com/maps?q=Rua+Exemplo+123+S√£o+Paulo" target="_blank" class="btn">Ver no Google Maps</a>
        <a href="presentes.html" class="btn-voltar">Ver lista de presentes</a>
    </div>

</div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
  // Inicializa Supabase
  const supabaseUrl = "https://beditqcysolsxdppnvdz.supabase.co";
  const supabaseKey = "YOUR_PUBLIC_KEY"; // Substitua por chave p√∫blica segura
  const supabase = supabase.createClient(supabaseUrl, supabaseKey);

  // Adicionar nova pessoa
  function adicionarPessoa() {
      const div = document.createElement("div");
      div.className = "pessoa";
      div.innerHTML = `
          <input type="text" placeholder="Nome" required>
          <input type="text" placeholder="Sobrenome" required>
          <button type="button" class="remover" onclick="this.parentElement.remove()">‚úï</button>
      `;
      document.getElementById("lista-pessoas").appendChild(div);
  }

  // Mostrar localiza√ß√£o
  function mostrarLocalizacao() {
      document.getElementById("formulario").style.display = "none";
      document.getElementById("localizacao").classList.remove("hidden");
  }

  // Confirmar presen√ßa
  async function confirmarPresenca() {
      const pessoas = [...document.querySelectorAll("#lista-pessoas .pessoa")].map(div => {
          return {
              nome: div.querySelector('input[placeholder="Nome"]').value.trim(),
              sobrenome: div.querySelector('input[placeholder="Sobrenome"]').value.trim()
          };
      });

      // Valida√ß√£o
      for (const p of pessoas) {
          if(!p.nome || !p.sobrenome) {
              alert("Preencha Nome e Sobrenome de todos.");
              return;
          }
      }

      if (pessoas.length === 0) {
          alert("Adicione pelo menos uma pessoa.");
          return;
      }

      // Envia para Supabase
      const { error } = await supabase.from('presencas').insert(pessoas);
      if (error) {
          alert("Erro ao confirmar presen√ßa.");
          console.error(error);
      } else {
          mostrarLocalizacao();
      }
  }

  // Evento submit
  document.getElementById('formPresenca').addEventListener('submit', function(e){
      e.preventDefault();
      confirmarPresenca();
  });
</script>

<style>
.hidden { display: none; }
</style>

</body>
</html>
